
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Full documentation for the Week06 project hosted on Deepwiki">
      
      
        <meta name="author" content="Lourdes12587">
      
      
      
        <link rel="prev" href="../User-Login/">
      
      
        <link rel="next" href="../Session-Management/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Role-Based Access Control - Week06 Project Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#role-based-access-control" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href=".." title="Week06 Project Documentation" class="md-header__button md-logo" aria-label="Week06 Project Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Week06 Project Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Role-Based Access Control
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://deepwiki.com/Lourdes12587/Week06/1-overview9" title="Ir al repositorio" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Deepwiki
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Pestañas" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../Overview/" class="md-tabs__link">
        
  
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../Getting-Started/" class="md-tabs__link">
        
  
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Project-Structure/" class="md-tabs__link">
          
  
  
  Project Structure

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Technology-Stack/" class="md-tabs__link">
          
  
  
  Architecture Overview

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../Authentication-%26-Authorization/" class="md-tabs__link">
          
  
  
  Authentication & Authorization

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Course-Management-System/" class="md-tabs__link">
          
  
  
  Course Management System

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../User-Profiles/" class="md-tabs__link">
          
  
  
  User Profiles

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Frontend-Architecture/" class="md-tabs__link">
          
  
  
  Frontend Architecture

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../API-Reference/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href=".." class="md-tabs__link">
          
  
  
  Appendix

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Week06 Project Documentation" class="md-nav__button md-logo" aria-label="Week06 Project Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Week06 Project Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://deepwiki.com/Lourdes12587/Week06/1-overview9" title="Ir al repositorio" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Deepwiki
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Getting-Started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Project Structure
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Project Structure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Project-Structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project Structure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Adding-New-Routes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Adding New Routes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architecture Overview
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Architecture Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Technology-Stack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Technology Stack
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Application-Entry-Point/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Application Entry Point
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Database-Architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Database Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Database-Operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Database Operations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Routing-System/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Routing System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Security-Considerations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security Considerations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Authentication & Authorization
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Authentication & Authorization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Authentication-%26-Authorization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../User-Registration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Registration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../User-Login/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Login
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Role-Based Access Control
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Role-Based Access Control
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose-and-scope" class="md-nav__link">
    <span class="md-ellipsis">
      Purpose and Scope
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-three-user-roles" class="md-nav__link">
    <span class="md-ellipsis">
      The Three User Roles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-middleware-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Middleware Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication Middleware Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#estaautenticado-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      estaAutenticado Middleware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#isadmin-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      isAdmin Middleware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#isregistrado-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      isRegistrado Middleware
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#middleware-chain-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      Middleware Chain Diagram
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#role-assignment-process" class="md-nav__link">
    <span class="md-ellipsis">
      Role Assignment Process
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Role Assignment Process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#during-registration" class="md-nav__link">
    <span class="md-ellipsis">
      During Registration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#during-login" class="md-nav__link">
    <span class="md-ellipsis">
      During Login
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#route-protection-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Route Protection Patterns
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detailed-route-protection-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Detailed Route Protection Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Detailed Route Protection Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#public-access-example-course-listing" class="md-nav__link">
    <span class="md-ellipsis">
      Public Access Example: Course Listing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registered-user-access-example-enrollment" class="md-nav__link">
    <span class="md-ellipsis">
      Registered User Access Example: Enrollment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#administrator-access-example-course-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Administrator Access Example: Course Creation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#access-control-decision-table" class="md-nav__link">
    <span class="md-ellipsis">
      Access Control Decision Table
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-based-role-storage" class="md-nav__link">
    <span class="md-ellipsis">
      Session-Based Role Storage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Security Considerations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#middleware-ordering" class="md-nav__link">
    <span class="md-ellipsis">
      Middleware Ordering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role-exclusivity" class="md-nav__link">
    <span class="md-ellipsis">
      Role Exclusivity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session-integrity" class="md-nav__link">
    <span class="md-ellipsis">
      Session Integrity
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Notes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Notes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optional-chaining-for-safety" class="md-nav__link">
    <span class="md-ellipsis">
      Optional Chaining for Safety
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-role-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      Default Role Assignment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Session-Management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Session Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Authentication-Views/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Authentication Views
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Authentication-Endpoints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Authentication Endpoints
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Course Management System
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Course Management System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Course-Management-System/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Creating-Courses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Creating Courses
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Editing-%26-Deleting-Courses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Editing & Deleting Courses
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Course-Listing-%26-Visibility/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Course Listing & Visibility
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Course-Enrollment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Course Enrollment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Course-Management-Endpoints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Course Management Endpoints
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Profiles
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            User Profiles
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../User-Profiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../User-Profile-Page/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Profile Page
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Administrator-Dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Administrator Dashboard
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Profile-Endpoints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Profile Endpoints
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Frontend Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Frontend Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Frontend-Architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Template-System-%26-Partials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Template System & Partials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Landing-Page/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Landing Page
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Styling-System/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Styling System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Development-Guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development Guide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../API-Reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Authentication-Endpoints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Authentication Endpoints
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Course-Management-Endpoints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Course Management Endpoints
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Profile-Endpoints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Profile Endpoints
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Appendix
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Appendix
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    README
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="role-based-access-control">Role-Based Access Control<a class="headerlink" href="#role-based-access-control" title="Permanent link">&para;</a></h1>
<blockquote>
<p><strong>Relevant source files</strong>
* <a href="routes/auth">routes/auth.js</a>
* <a href="routes/courses">routes/courses.js</a></p>
</blockquote>
<h2 id="purpose-and-scope">Purpose and Scope<a class="headerlink" href="#purpose-and-scope" title="Permanent link">&para;</a></h2>
<p>This document describes the role-based access control (RBAC) system that governs user permissions throughout the application. The system defines three distinct user roles and implements middleware functions that restrict access to routes based on authentication status and assigned roles. This page focuses on the middleware implementation and role enforcement mechanisms. For information about the login and authentication process, see <a href="4.2-user-login.md">User Login</a>. For session storage details, see <a href="4.4-session-management.md">Session Management</a>.</p>
<hr />
<h2 id="the-three-user-roles">The Three User Roles<a class="headerlink" href="#the-three-user-roles" title="Permanent link">&para;</a></h2>
<p>The application defines three user roles with escalating privileges:</p>
<table>
<thead>
<tr>
<th>Role</th>
<th>Database Value</th>
<th>Description</th>
<th>Assignment Method</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Public</strong></td>
<td><code>'publico'</code></td>
<td>Unauthenticated visitors</td>
<td>Default for non-logged-in users</td>
</tr>
<tr>
<td><strong>Registered</strong></td>
<td><code>'registrado'</code></td>
<td>Authenticated regular users</td>
<td>Default role during registration</td>
</tr>
<tr>
<td><strong>Administrator</strong></td>
<td><code>'admin'</code></td>
<td>Authenticated administrators</td>
<td>Manual assignment in database or during registration</td>
</tr>
</tbody>
</table>
<p>The role is stored in the <code>usuarios</code> table as an enum field and is loaded into the session upon successful authentication <a href="routes/auth#L100-L104">routes/auth.js L100-L104</a></p>
<p><strong>Sources:</strong> routes/auth.js, routes/courses.js</p>
<hr />
<h2 id="authentication-middleware-functions">Authentication Middleware Functions<a class="headerlink" href="#authentication-middleware-functions" title="Permanent link">&para;</a></h2>
<p>The system implements three middleware functions in <code>routes/courses.js</code> that enforce access control at the route level:</p>
<h3 id="estaautenticado-middleware">estaAutenticado Middleware<a class="headerlink" href="#estaautenticado-middleware" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">estaAutenticado</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span>
</code></pre></div>
<p>This middleware verifies that a user is logged in by checking for an active session. It serves as the base authentication check for all protected routes.</p>
<p><strong>Implementation:</strong> <a href="routes/courses#L8-L14">routes/courses.js L8-L14</a></p>
<p><strong>Logic:</strong></p>
<ul>
<li>Checks if <code>req.session.loggedin</code> is truthy</li>
<li>If authenticated, calls <code>next()</code> to proceed to the next middleware or route handler</li>
<li>If not authenticated, redirects to <code>/login</code></li>
</ul>
<p><strong>Usage:</strong> Applied to all routes that require any level of authentication, including both registered user and admin routes.</p>
<hr />
<h3 id="isadmin-middleware">isAdmin Middleware<a class="headerlink" href="#isadmin-middleware" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">isAdmin</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span>
</code></pre></div>
<p>This middleware enforces administrator-only access by verifying both authentication status and role.</p>
<p><strong>Implementation:</strong> <a href="routes/courses#L16-L24">routes/courses.js L16-L24</a></p>
<p><strong>Logic:</strong></p>
<ul>
<li>Checks if <code>req.session.loggedin</code> is truthy AND <code>req.session.rol === 'admin'</code></li>
<li>If both conditions are met, calls <code>next()</code></li>
<li>If either condition fails, redirects to <code>/login</code></li>
</ul>
<p><strong>Usage:</strong> Applied to all course management CRUD operations (create, edit, update, delete) and the admin profile route.</p>
<hr />
<h3 id="isregistrado-middleware">isRegistrado Middleware<a class="headerlink" href="#isregistrado-middleware" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">isRegistrado</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span>
</code></pre></div>
<p>This middleware restricts access to registered users, excluding administrators from routes meant specifically for regular users.</p>
<p><strong>Implementation:</strong> <a href="routes/courses#L26-L33">routes/courses.js L26-L33</a></p>
<p><strong>Logic:</strong></p>
<ul>
<li>Checks if <code>req.session.loggedin</code> is truthy AND <code>req.session.rol === 'registrado'</code></li>
<li>If both conditions are met, calls <code>next()</code></li>
<li>If either condition fails, redirects to <code>/login</code></li>
</ul>
<p><strong>Usage:</strong> Applied to enrollment routes and the regular user profile page.</p>
<p><strong>Sources:</strong> routes/courses.js:8-33</p>
<hr />
<h2 id="middleware-chain-diagram">Middleware Chain Diagram<a class="headerlink" href="#middleware-chain-diagram" title="Permanent link">&para;</a></h2>
<p><strong>Diagram: Authentication Middleware Flow</strong></p>
<pre class="mermaid"><code>flowchart TD

Request["HTTP Request"]
RouteHandler["Route Handler"]
CheckProtection["Route Protected?"]
PublicRoute["Execute Route&lt;br&gt;Handler Directly"]
EstaAutenticado["estaAutenticado()&lt;br&gt;[courses.js:8-14]"]
SessionCheck["req.session.loggedin&lt;br&gt;exists?"]
RedirectLogin1["res.redirect('/login')"]
RoleRequired["Role-Specific&lt;br&gt;Middleware?"]
ExecuteHandler["Execute Route Handler"]
CheckAdmin["isAdmin()&lt;br&gt;[courses.js:16-24]"]
CheckRegistrado["isRegistrado()&lt;br&gt;[courses.js:26-33]"]
AdminCheck["req.session.rol&lt;br&gt;=== 'admin'?"]
RedirectLogin2["res.redirect('/login')"]
ExecuteAdminHandler["Execute Admin&lt;br&gt;Route Handler"]
RegisteredCheck["req.session.rol&lt;br&gt;=== 'registrado'?"]
RedirectLogin3["res.redirect('/login')"]
ExecuteRegisteredHandler["Execute Registered&lt;br&gt;User Route Handler"]

Request --&gt; RouteHandler
RouteHandler --&gt; CheckProtection
CheckProtection --&gt; PublicRoute
CheckProtection --&gt; EstaAutenticado
EstaAutenticado --&gt; SessionCheck
SessionCheck --&gt; RedirectLogin1
SessionCheck --&gt; RoleRequired
RoleRequired --&gt; ExecuteHandler
RoleRequired --&gt; CheckAdmin
RoleRequired --&gt; CheckRegistrado
CheckAdmin --&gt; AdminCheck
AdminCheck --&gt; RedirectLogin2
AdminCheck --&gt; ExecuteAdminHandler
CheckRegistrado --&gt; RegisteredCheck
RegisteredCheck --&gt; RedirectLogin3
RegisteredCheck --&gt; ExecuteRegisteredHandler</code></pre>
<p><strong>Sources:</strong> routes/courses.js:8-33</p>
<hr />
<h2 id="role-assignment-process">Role Assignment Process<a class="headerlink" href="#role-assignment-process" title="Permanent link">&para;</a></h2>
<h3 id="during-registration">During Registration<a class="headerlink" href="#during-registration" title="Permanent link">&para;</a></h3>
<p>When a user registers, their role is assigned in the database insertion operation:</p>
<p><strong>Implementation:</strong> <a href="routes/auth#L43-L52">routes/auth.js L43-L52</a></p>
<div class="highlight"><pre><span></span><code><span class="nt">rol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rol || &#39;registrado&#39;</span>
</code></pre></div>
<p>The system defaults to <code>'registrado'</code> if no role is explicitly provided in the registration form, though the standard registration form does not expose role selection to users.</p>
<hr />
<h3 id="during-login">During Login<a class="headerlink" href="#during-login" title="Permanent link">&para;</a></h3>
<p>Upon successful authentication, the user's role is loaded from the database and stored in the session:</p>
<p><strong>Implementation:</strong> <a href="routes/auth#L100-L104">routes/auth.js L100-L104</a></p>
<p>The session object is populated with:</p>
<ul>
<li><code>req.session.loggedin = true</code></li>
<li><code>req.session.usuario = results[0]</code> (full user object)</li>
<li><code>req.session.rol = usuario.rol</code> (extracted role value)</li>
</ul>
<p>This role value persists throughout the user's session and is checked by middleware on each protected route request.</p>
<p><strong>Sources:</strong> routes/auth.js:43-52, routes/auth.js:100-104</p>
<hr />
<h2 id="route-protection-patterns">Route Protection Patterns<a class="headerlink" href="#route-protection-patterns" title="Permanent link">&para;</a></h2>
<p><strong>Diagram: Routes by Access Level</strong></p>
<pre class="mermaid"><code>flowchart TD

ADM1["GET /create&lt;br&gt;(routes/courses.js:64)"]
ADM2["POST /save&lt;br&gt;(routes/courses.js:70)"]
ADM3["GET /edit/:id&lt;br&gt;(routes/courses.js:73)"]
ADM4["POST /update&lt;br&gt;(routes/courses.js:103)"]
ADM5["GET /delete/:id&lt;br&gt;(routes/courses.js:87)"]
ADM6["GET /admin/perfil&lt;br&gt;(routes/courses.js:172)"]
U1["GET /inscribir/:id&lt;br&gt;(routes/courses.js:106)"]
U2["POST /inscribir/:id&lt;br&gt;(routes/courses.js:117)"]
U3["GET /perfil&lt;br&gt;(routes/courses.js:152)"]
A1["POST /logout&lt;br&gt;(routes/auth.js:134)"]
R1["GET /&lt;br&gt;(routes/index.js)"]
R2["GET /login&lt;br&gt;(routes/auth.js:8)"]
R3["GET /register&lt;br&gt;(routes/auth.js:12)"]
R4["POST /auth&lt;br&gt;(routes/auth.js:75)"]
R5["POST /register&lt;br&gt;(routes/auth.js:17)"]
R6["GET /courses*&lt;br&gt;(routes/courses.js:35)"]

subgraph Admin ["Admin Routes (estaAutenticado + isAdmin)"]
    ADM1
    ADM2
    ADM3
    ADM4
    ADM5
    ADM6
end

subgraph Registered ["Registered User Routes (estaAutenticado + isRegistrado)"]
    U1
    U2
    U3
end

subgraph Authenticated ["Authenticated Routes (estaAutenticado)"]
    A1
end

subgraph Public ["Public Routes (No Middleware)"]
    R1
    R2
    R3
    R4
    R5
    R6
end</code></pre>
<p><strong>Sources:</strong> routes/auth.js, routes/courses.js</p>
<hr />
<h2 id="detailed-route-protection-examples">Detailed Route Protection Examples<a class="headerlink" href="#detailed-route-protection-examples" title="Permanent link">&para;</a></h2>
<h3 id="public-access-example-course-listing">Public Access Example: Course Listing<a class="headerlink" href="#public-access-example-course-listing" title="Permanent link">&para;</a></h3>
<p>The <code>/courses</code> route is publicly accessible but implements role-based content filtering:</p>
<p><strong>Implementation:</strong> <a href="routes/courses#L35-L62">routes/courses.js L35-L62</a></p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">rol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="o">?</span><span class="p">.</span><span class="nx">rol</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;publico&#39;</span><span class="p">;</span>
</code></pre></div>
<ul>
<li>Public users (<code>'publico'</code>): SQL query filtered with <code>WHERE visibilidad='publico'</code></li>
<li>Registered and admin users: No WHERE clause, all courses visible</li>
</ul>
<hr />
<h3 id="registered-user-access-example-enrollment">Registered User Access Example: Enrollment<a class="headerlink" href="#registered-user-access-example-enrollment" title="Permanent link">&para;</a></h3>
<p>The enrollment routes require both authentication and the <code>'registrado'</code> role:</p>
<p><strong>Implementation:</strong> <a href="routes/courses#L106-L114">routes/courses.js L106-L114</a></p>
<p>and <a href="routes/courses#L117-L149">routes/courses.js L117-L149</a></p>
<p><strong>Middleware Chain:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/inscribir/:id&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">estaAutenticado</span><span class="p">,</span><span class="w"> </span><span class="nx">isRegistrado</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">})</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&quot;/inscribir/:id&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">estaAutenticado</span><span class="p">,</span><span class="w"> </span><span class="nx">isRegistrado</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">})</span>
</code></pre></div>
<p>The middleware chain executes left to right:</p>
<ol>
<li><code>estaAutenticado</code> verifies session exists</li>
<li><code>isRegistrado</code> verifies <code>req.session.rol === 'registrado'</code></li>
<li>Route handler executes only if both checks pass</li>
</ol>
<hr />
<h3 id="administrator-access-example-course-creation">Administrator Access Example: Course Creation<a class="headerlink" href="#administrator-access-example-course-creation" title="Permanent link">&para;</a></h3>
<p>All CRUD operations require both authentication and the <code>'admin'</code> role:</p>
<p><strong>Implementation:</strong> <a href="routes/courses#L64-L66">routes/courses.js L64-L66</a></p>
<p>for the form, <a href="routes/courses#L70-L70">routes/courses.js L70</a></p>
<p>for saving</p>
<p><strong>Middleware Chain:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/create&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">estaAutenticado</span><span class="p">,</span><span class="w"> </span><span class="nx">isAdmin</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">})</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/save&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">estaAutenticado</span><span class="p">,</span><span class="w"> </span><span class="nx">isAdmin</span><span class="p">,</span><span class="w"> </span><span class="nx">crud</span><span class="p">.</span><span class="nx">save</span><span class="p">)</span>
</code></pre></div>
<p><strong>Sources:</strong> routes/courses.js:35-185</p>
<hr />
<h2 id="access-control-decision-table">Access Control Decision Table<a class="headerlink" href="#access-control-decision-table" title="Permanent link">&para;</a></h2>
<p>The following table summarizes route accessibility by role:</p>
<table>
<thead>
<tr>
<th>Route Pattern</th>
<th>Public</th>
<th>Registered</th>
<th>Admin</th>
<th>Middleware Applied</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/</code>, <code>/login</code>, <code>/register</code></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>None</td>
</tr>
<tr>
<td><code>POST /auth</code>, <code>POST /register</code></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>None</td>
</tr>
<tr>
<td><code>GET /courses</code></td>
<td>✓ (filtered)</td>
<td>✓ (all)</td>
<td>✓ (all)</td>
<td>None</td>
</tr>
<tr>
<td><code>POST /logout</code></td>
<td>✗</td>
<td>✓</td>
<td>✓</td>
<td><code>estaAutenticado</code></td>
</tr>
<tr>
<td><code>/inscribir/:id</code> (GET/POST)</td>
<td>✗</td>
<td>✓</td>
<td>✗</td>
<td><code>estaAutenticado</code>, <code>isRegistrado</code></td>
</tr>
<tr>
<td><code>/perfil</code></td>
<td>✗</td>
<td>✓</td>
<td>✗</td>
<td><code>estaAutenticado</code>, <code>isRegistrado</code></td>
</tr>
<tr>
<td><code>/create</code>, <code>/save</code></td>
<td>✗</td>
<td>✗</td>
<td>✓</td>
<td><code>estaAutenticado</code>, <code>isAdmin</code></td>
</tr>
<tr>
<td><code>/edit/:id</code>, <code>/update</code></td>
<td>✗</td>
<td>✗</td>
<td>✓</td>
<td><code>estaAutenticado</code>, <code>isAdmin</code></td>
</tr>
<tr>
<td><code>/delete/:id</code></td>
<td>✗</td>
<td>✗</td>
<td>✓</td>
<td><code>estaAutenticado</code>, <code>isAdmin</code></td>
</tr>
<tr>
<td><code>/admin/perfil</code></td>
<td>✗</td>
<td>✗</td>
<td>✓</td>
<td><code>estaAutenticado</code>, <code>isAdmin</code></td>
</tr>
</tbody>
</table>
<p><strong>Sources:</strong> routes/auth.js, routes/courses.js</p>
<hr />
<h2 id="session-based-role-storage">Session-Based Role Storage<a class="headerlink" href="#session-based-role-storage" title="Permanent link">&para;</a></h2>
<p><strong>Diagram: Role Data Flow from Database to Middleware</strong></p>
<pre class="mermaid"><code>flowchart TD

DB["MySQL Database&lt;br&gt;usuarios table&lt;br&gt;rol column"]
Query["SELECT * FROM usuarios&lt;br&gt;WHERE email = ?&lt;br&gt;[auth.js:82-83]"]
Results["results[0]&lt;br&gt;(user object)"]
SessionAssign["req.session.usuario = results[0]&lt;br&gt;req.session.rol = usuario.rol&lt;br&gt;req.session.loggedin = true&lt;br&gt;[auth.js:102-104]"]
SessionStore["Express Session Store&lt;br&gt;(express-session middleware)"]
NextRequest["Subsequent HTTP Request&lt;br&gt;with session cookie"]
MiddlewareCheck["Middleware Function&lt;br&gt;(estaAutenticado/isAdmin/isRegistrado)"]
RolCheck["Check req.session.rol&lt;br&gt;against required value"]
AllowAccess["next() called&lt;br&gt;Route handler executes"]
DenyAccess["res.redirect('/login')&lt;br&gt;Access denied"]

DB --&gt; Query
Query --&gt; Results
Results --&gt; SessionAssign
SessionAssign --&gt; SessionStore
SessionStore --&gt; NextRequest
NextRequest --&gt; MiddlewareCheck
MiddlewareCheck --&gt; RolCheck
RolCheck --&gt; AllowAccess
RolCheck --&gt; DenyAccess</code></pre>
<p><strong>Sources:</strong> routes/auth.js:82-104, routes/courses.js:8-33</p>
<hr />
<h2 id="security-considerations">Security Considerations<a class="headerlink" href="#security-considerations" title="Permanent link">&para;</a></h2>
<h3 id="middleware-ordering">Middleware Ordering<a class="headerlink" href="#middleware-ordering" title="Permanent link">&para;</a></h3>
<p>Middleware functions must be applied in the correct order to ensure proper access control:</p>
<ol>
<li><strong>Always apply <code>estaAutenticado</code> first</strong> before role-specific middleware</li>
<li><strong>Apply role middleware second</strong> (<code>isAdmin</code> or <code>isRegistrado</code>)</li>
<li><strong>Route handler executes last</strong></li>
</ol>
<p>Incorrect ordering would allow unauthenticated users to bypass authentication checks.</p>
<hr />
<h3 id="role-exclusivity">Role Exclusivity<a class="headerlink" href="#role-exclusivity" title="Permanent link">&para;</a></h3>
<p>The current implementation makes roles mutually exclusive in protected routes:</p>
<ul>
<li>Routes with <code>isRegistrado</code> <strong>only allow</strong> users with role <code>'registrado'</code></li>
<li>Routes with <code>isAdmin</code> <strong>only allow</strong> users with role <code>'admin'</code></li>
<li>An administrator cannot access <code>/inscribir/:id</code> or <code>/perfil</code> because these check for <code>rol === 'registrado'</code></li>
</ul>
<p>This design separates administrative and user workflows completely.</p>
<hr />
<h3 id="session-integrity">Session Integrity<a class="headerlink" href="#session-integrity" title="Permanent link">&para;</a></h3>
<p>The role stored in <code>req.session.rol</code> is considered authoritative for the duration of the session. The system does not re-query the database to verify roles on each request, relying instead on session data integrity. If a user's role is changed in the database, they must log out and log back in for the change to take effect.</p>
<p><strong>Sources:</strong> routes/courses.js:8-33, routes/auth.js:100-104</p>
<hr />
<h2 id="implementation-notes">Implementation Notes<a class="headerlink" href="#implementation-notes" title="Permanent link">&para;</a></h2>
<h3 id="optional-chaining-for-safety">Optional Chaining for Safety<a class="headerlink" href="#optional-chaining-for-safety" title="Permanent link">&para;</a></h3>
<p>The middleware functions use optional chaining (<code>?.</code>) to safely access session properties:</p>
<div class="highlight"><pre><span></span><code>req.session?.loggedin
req.session?.rol
</code></pre></div>
<p>This prevents runtime errors if the session object is undefined, though in practice the Express session middleware ensures <code>req.session</code> always exists.</p>
<p><strong>Implementation:</strong> <a href="routes/courses#L17-L17">routes/courses.js L17</a></p>
<p><a href="routes/courses#L27-L27">routes/courses.js L27</a></p>
<hr />
<h3 id="default-role-assignment">Default Role Assignment<a class="headerlink" href="#default-role-assignment" title="Permanent link">&para;</a></h3>
<p>The course listing route demonstrates defensive programming by defaulting to <code>'publico'</code> when no session exists:</p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">rol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="o">?</span><span class="p">.</span><span class="nx">rol</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;publico&#39;</span><span class="p">;</span>
</code></pre></div>
<p><strong>Implementation:</strong> <a href="routes/courses#L36-L36">routes/courses.js L36</a></p>
<p>This allows the route to handle both authenticated and unauthenticated users gracefully without requiring authentication middleware.</p>
<p><strong>Sources:</strong> routes/courses.js:17-36</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand", "navigation.sections", "navigation.tabs", "toc.integrate", "content.code.copy", "content.action.edit"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
      
        <script src="../javascripts/mermaid-init.js"></script>
      
    
  </body>
</html>